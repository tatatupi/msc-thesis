%-------------------------------------------------------------------------------
\chapter{Results}
\label{cap4} \vspace{-1cm} \vspace{1cm}

%\begin{flushright}
%\begin{minipage}{0.7\linewidth}
%\emph{``O homem é como uma função, cujo numerador é o que ele é e
%cujo denominador é o que ele pensa dele mesmo. Quanto maior o
%denominador, menor a fração.''}
%\end{minipage}
%\end{flushright}
%
%\begin{flushright}
%{L. N. Tolstói}
%\end{flushright}

%\section{Introdução}

In this chapter, we present simulation results for two different systems: nonholomonic unicycle position estimation, and longitudinal motion dynamics of an advanced aircraft.

We begin by describing the simulated systems as a state-space representation. First system is discretized and a discrete unscented Kalman filter is used for the estimation of the unicycle position. The second one is represented as a continuous-time process model with digital measurements of one state. We wish to estimated a all states by a sampled-data Kalman filter.

For both cases, we start evaluating the effect of time-stamp information in the estimation algorithm for three different irregular sampling scenarios, without time-delay in the observations: variation of the observation signal-to-noise ratio, variation of the observation average sampling rate, and variation of the relation between estimation regular sampling rate and output irregular average sampling rate. 

Then we add random time-delay to the observation model and evaluate the effect for the same three scenarios plus a fourth one, where we vary the average time-delay.


\duvida{O que acha dos cenários e das simulações? Está suficiente?}

\section{Unicycle Position Estimation}

\subsection{Introduction}

\textit{Descrever as motivações por trás do estudo da amostragem irregular para problemas de rastreamento de robôs. Exemplos: medições feitas por câmeras não sincronizadas e utilizando redes de internet (com time delay).}

\subsection{System Description}

Consider a nonholomonic moving robot, with the cinematic process model given by

\setlength{\abovedisplayskip}{0.5pt}

\begin{equation}\label{eq:sistema}
\begin{split}
\dot{p}_\textrm{x} & = v\cos (\theta),\\
\dot{p}_\textrm{y} & = v\sin (\theta),\\
\dot{\theta}  & = u_1(t),\\
\dot{v} & = u_2(t),
\end{split}
\end{equation}
\noindent

where $p_\textrm{x}$ and $p_\textrm{y}$ are the position coordinates, $\theta$ the angular orientation, $v$ the linear velocity and inputs $u_1$ and $u_2$ are the angular velocity $\omega$ and the linear acceleration $a$, respectively.

The system described by~\ref{eq:sistema} is discretized by a 4$^{th}$ order Runge-Kutta method and the state vector $x_i$ is given by $x_i \overset{\Delta}{=} [p_{\textrm{x},i}\ p_{\textrm{y},i}\ \theta_i\ v_i]^T$.

The observation model $y(t_k) \in \mathbb{R}^2$

\begin{equation}
y(t_k) = 
\begin{bmatrix}
p_\textrm{x}(t_k) \\
p_\textrm{y}(t_k)
\end{bmatrix}+v(t_k), \\
\end{equation}

\noindent
is given by the position coordinates and $v(t_k) \sim \mathcal{N} (0,R_{t_k})$ is the observation noise, with zero mean and covariance $R_{t_k}$. When time-stamp is not available, the observation vector is approximated by $\tilde{y}_i \approx y(t_k)$, where $i$ is the index of the next time instant, multiple of $T$.

Input vector $u_i = [\omega_i\ a_i]^T$ is measured by a girometer and accelerometer, respectively. We assume that 

\begin{equation}\label{eq:entrada}
u_i = \tilde{u}_i - w_i,
\end{equation}

\noindent
where $\tilde{u}$ is the sensors measured valueand $w \sim \mathcal{N} (0, Q_i)$ represents the corresponded noise, of zero mean and covariance $Q_i$. 

We simulate 60 seconds of robot movement, considering a step size of $\delta t_{\textrm{sim}} = 10^{-4}$. Irregular sampling time intervals $h_k$ are simulated by the exponential probability distribution function from MatLab\texttrademark \ and approximated to the nearest discrete time instant, from the 600,000 available samples. Input signals were generated arbitrarily according to Fig.~\ref{fig:entrada}. Fig.~\ref{fig:exukf} shows robot trajectory on $xy$-plane for the given input signals, leaving from point $(0,0)$, as well as a realization of noisy and aperiodic measurements with signal-to-noise ratio of SNR\textsubscript{y} $= 30$ dB and $\lambda=0.3$ s as red dots and the hatched blue line represents UKF estimation, considering time-stamp and $\alpha=5$. 


\begin{figure}[!htb]
	\centering
	\begin{subfigure}
		\centering
		\includegraphics[width=\textwidth]{Imagens/entradas1.eps}	
%		\caption{}
		\label{fig:sfig1}
	\end{subfigure}
	\begin{subfigure}
		\centering
		\includegraphics[width=\textwidth]{Imagens/entradas2.eps}
%		\caption{}
		\label{fig:sfig2}
	\end{subfigure}
	\caption[Entradas]{Simulation input signals. (a) shows temporal sequence of angular velocity $\omega$ and (b) shows linear acceleration $a$.}
	\label{fig:entrada}
\end{figure}

\begin{figure}[!htb]
	\centering
	\includegraphics[width=\textwidth]{Imagens/exemplo_03_30db_desloc.eps}
	\caption[entrada]{True position, noisy measurements and UKF estimates considering time-stamp, for a measurement noise of SNR\textsubscript{y} $= 30$ dB, $\lambda=0.3$ s and $\alpha=5$.}
	\label{fig:exukf}
\end{figure} 

To analyze the effect of considering time-stamp in the estimation algorithm, we use the performance index $J$

\begin{equation}\label{eq:inddesemp}
J = \frac{ \sum_{i=1}^N \sqrt{(\hat{p}_{\textrm{x},i}-p_{\textrm{x},i})^2+(\hat{p}_{\textrm{y},i}-p_{\textrm{y},i})^2}}{N}
\end{equation}

\noindent

where $\hat{p}_{\textrm{x},i}$ and $\hat{p}_{\textrm{y},i}$ are filter position estimates produced at a regular interval $T$, $\hat{p}_{\textrm{x},i}$ and $\hat{p}_{\textrm{y},i}$ the true coordinates of the robot at the same time instants and $N$ the total number of estimates. This index represents the average estimator position error in $xy$-plane.

Fig.~\ref{fig:realizacaoJ} shows a timespan from 0 to 1.3 seconds of a $J$ realization, considering $\lambda=0.5$, $\alpha=5$, SNR\textsubscript{y} $=60dB$ dB and SNR\textsubscript{u} $=20$ dB, for the UKF considering and not considering time-stamp. Black dots represent the regular time instants $kT$ whereas the asterisks on x-axis match the exact measurement instants $t_k$. As expected, before the first data assimilation steps, both performances are identical. Since the first measurement $t_1$ was taken almost at the same time as regular estimation time interval $4t$, both estimation performances maintain close to each other. That is because the approximation error due to $\tilde{y}_i \approx y(t_k)$ is irrelevant. At $t_2$ we can observe significant deviation from index $J$ in benefit of the algorithm considering time-stamp, since it performs data assimilation at the exact time measurement was taken. The same effect can be noted at $t_4$, after 1 second of simulation, when there is a significant different between time the measurement was taken and the next regular estimation instant.


\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{Imagens/J_umarealizacao.eps}
	\caption[entrada]{Temporal cut from 0 to 1.3 seconds, for a realization of $J$ of both estimatores, with and without time-stamp. Asterisks on $x$ axis match the measurement sampling instants $t_k$. Black dots represent the regular estimation instants, same as input regular sampling instants.}
	\label{fig:realizacaoJ}
\end{figure} 

%\begin{figure}[!htb]
%	\centering
%	\includegraphics[width=0.8\textwidth]{Imagens/J_umarealizacao-timedelay.eps}
%%%	\caption[entrada]{Recorte temporal de 1 a 1.3 segundo, do índice J de uma realização dos dois estimadores, com e sem carimbo de tempo. Os asteriscos no eixo $x$ representam os instantes de amostragem das observações $t_k$. Os pontos pretos apresentados nas linhas representam os instantes de tempo regulares de amostragem da entrada}
%	\label{fig:realizacaoJ2}
%\end{figure} 



%\setlength{\abovedisplayskip}{0.5pt}
%
%\begin{equation}\label{eq:sistema}
%\begin{split}
%\dot{\delta_e} & = -\tau^{-1},\\
%\dot{W} & = Z_{de}\delta_e + Z_wW + S_0q,\\
%\dot{q}  & = S_1 \delta_e + S_2 W + S_3q,\\
%\end{split}
%\end{equation}
%\noindent

\subsection{Measurement Signal-to-Noise Ratio Variation}\label{sec:ruido-robo}

In this subsection we compare the estimation performance impact of considering time-stamp in the algorithm, by varying the measurement noise level. The signal-to-noise ratio for the input sensors and the measurement average time interval are held constant, SNR\textsubscript{u} $= 20$ dB and $\lambda = 0.1$ s.

We considered an observation signal-to-noise variation of SNR\textsubscript{y} = $\infty$,  $80$, $60$, $40$, $20$, $10$ dB. That is, initially the system was simulated considering no measurement noise and then it was gradually increased. For each noise scenario, we ran 100 realizations of the random variables for each algorithm and Figure~\ref{fig:noise} shows the results. Solid lines represent the average values for $J$ and the dashed lines are the 95\% confidence interval.

\todo[inline]{Falta incluir resultados com time-delay}


\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{Imagens/noise.eps}
	\caption[entrada]{Performance index $J$ variation, as a function of measurement noise both UKF algorithms considering and not considering time-stamp}
	\label{fig:noise}
\end{figure} 


\textit{É possível observar que o estimador que considera o carimbo de tempo possui desempenho estatisticamente superior apenas para baixos níveis de ruído da observação. Quando SNR\textsubscript{y} é igual a $\infty$ e $80$ dB, o índice de desempenho $J$ do filtro com carimbo de tempo é aproximadamente $1.25$ e $1.26$ cm, respectivamente, mais preciso do que sem carimbo de tempo e com variância pequena. Quando a relação sinal ruído se aproxima de $40$ dB, no entanto, não é possível distinguir estatisticamente o efeito de se considerar ou não carimbo de tempo.
}


\subsection{Average Sampling Rate Variation}\label{sec:lambda-robot}

We now consider the variation of the average time interval that observations are taken, according to $\lambda =$ $0.1$, $0.2$, $0.3$, $0.4$, $0.5$, $0.6$ s, maintaining the other parameters constant, namely the noise level of inputs and observations, SNR\textsubscript{u} $= 20$ dB and SNR\textsubscript{y} $= 40$ dB, respectively. We carried out 100 realizations for each $\lambda$ and for each algorithm and Figure~\ref{fig:samp} presents the results. Again, the solid lines are the average values of $J$ and the 95\% confidence interval is between the dashed lines.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{Imagens/samp.eps}
	\caption[entrada]{Performance index $J$ variation, as a function of measurement noise both UKF algorithms considering and not considering time-stamp}
	\label{fig:samp}
\end{figure}


\textit{Os resultados obtidos demonstram que a diferença no desempenho dos filtros é mais significativa para intervalos de tempo mais espaçados, mantendo-se a dinâmica do sistema e os outros parâmetros fixos. Inicialmente, para valores pequenos de $\lambda$	, não há diferença estatística entre o desempenho dos estimadores, mas a medida que o intervalo cresce, ela aparece, chegando a aproximadamente $3.1$ cm para um $\lambda = 0.6$ s. Uma interpretação possível é que, se o intervalo de tempo médio das observações for muito pequeno em comparação com a velocidade em que a dinâmica do sistema varia, o erro de aproximação do instante de amostragem das observações $t_k$ é reduzido. O ruído do sensor pode acabar sendo mais relevante do que o erro devido ao tempo incorreto de assimilação.}


\subsection{Regular and Average Irregular Time Interval Relation Variation}\label{sec:alpha-robot}

We also analyze the performance impact of varying the parameter $\alpha$, which is the relation between regular input time interval $T$ and average measurements time interval $\lambda$. The simulated values were $\alpha = 10$, $5$, $2$, $1$. That means we start with higher frequency values for input sampling in comparison to measurement sampling and this values is gradually decreased. Other parameters were maintained constant SNR\textsubscript{u} $= 20$ dB and SNR\textsubscript{y} $= 40$ dB.

The same way we did for the other scenarios, 100 realizations were simulated and Figure~\ref{fig:dtudty} presents the results. Solid lines are the average values for $J$ and dashed lines represent the 95\% confidence interval.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{Imagens/dtudty.eps}
	\caption[entrada]{Performance index $J$ variation, as a function of measurement noise both UKF algorithms considering and not considering time-stamp}
	\label{fig:dtudty}
\end{figure}


\textit{
Nota-se que, quando o carimbo de tempo é considerado, não há diferença significativa em se variar o $\alpha$ no desempenho do filtro, com o índice de desempenho $J$ se mantendo pouco abaixo dos $3$ cm. Ou seja, não importa a relação entre as frequências de amostragem da observação e das entradas. Por outro lado, quando não se considera o carimbo de tempo, essa relação se torna relevante para o índice de desempenho do estimador. Quanto mais lento a frequência da entrada em comparação com a frequência da saída, maior o erro obtido. Para o caso mais extremo utilizado, $\alpha=1$, a diferença no índice $J$ foi mais do que o dobro. Esse resultado era esperado, uma vez que quanto maior o valor de $\alpha$, mais rápida é a taxa de discretização do modelo de processo em relação à frequência dos sensores de observação. Consequentemente, o erro obtido na aproximação $\tilde{y}(i) \approx y(t_k)$ diminui.
}

\subsection{Average Time Delay}\label{sec:dt-robot}

\todo[inline,caption={Falta variar o atraso nas medições}]{Ainda terá uma seção com a variação do time-delay e seu impacto no desempenho}


\section{Longitudinal Motion Dynamics of an Advanced Aircraft}

\subsection{Introduction}

\textit{Descrever as motivações por trás do estudo da amostragem irregular para problemas de aviação. Exemplos: multiplexed data network is used for communications between the control system components~\cite{Ray1993}.}


\subsection{System Description}
\todo[caption={Falta incluir figura explicativa do processo},inline]{Ainda pretendo incluir uma figura do processo, para facilitar entendimento}

Consider the process model of flight dynamics in continuous time given by:

\begin{equation}\label{eq:aircraft}
\dot{x}(t) = Fx(t) + Bu(t) + G\omega(t) \\
\end{equation}

\begin{equation*}
x(t) =  \begin{bmatrix}
\delta_e \quad W \quad q 	
\end{bmatrix}^T; \quad
u(t) = \delta_a; \quad
\omega(t) \sim \mathcal{N} (0, 1)
\end{equation*}

\begin{equation*}
F =  \begin{bmatrix}
-\tau^{-1} 	& 0 	& 0 \\
Z_{de} 		& Z_w 	& S_0 \\
S_1 		& S_2 	& S_3 
\end{bmatrix}; \quad
B =  \begin{bmatrix}
1 \\
0 \\
0 		
\end{bmatrix}; \quad 
G =  \begin{bmatrix}
0.00625 \\
0.25 \\
0.025		
\end{bmatrix}
\end{equation*}

\begin{center}
	$S_0 = (Z_q + U_o)$ \\
	$S_1 = (M_{de} + M_{wd}Z_{de})$ \\
	$S_2 = (M_w + M_{wd}*Z_w)$ \\
	$S_3 = (M_q + M_{wd}+S_0)$
\end{center}

\noindent
where plant variables $\delta_e$ is elevator deflection (radian), $W$ is the normal component of linear velocity at the center of mass (m/s), $q$ is the pitch rate about the center of mass (radian/s) and input $\delta_a$ is the elevator command (radian).

The parameters for the longitudinal motion dynamics were chosen to be the same as the work of~\citep{Ray1993}, knowingly:


\begin{equation}\label{eq:sistema}
\begin{split}
Z_{de} & := (\partial Z/\partial \delta_e)/m = -61.655 \ m/s^2,\\
Z_q & := (\partial Z/\partial q)/m = -5.132 \ m/s,\\
Z_w & := (\partial Z/\partial W)/m = -3.1332 \ s^{-1},\\
M_{de} & := (\partial M/\partial \delta_e)/I_y = -40.465 \ s^{-2},\\
M_q & := (\partial M/\partial q)/I_y = -2.6864 \ s^{-1},\\
M_w & := (\partial M/\partial W)/I_y = -0.04688 \ (s-m)^{-1},\\
\tau & = 0.1 \ s \\
U_o & = 306.42 \ m/s
\end{split}
\end{equation}

\noindent
where $M$ is the pitch moment ($m^2 / kgm / s^{-2}$), $Z$ is the normal component of the aerodynamics force ($m / kgm / s^{-2}$), $m$ is the lumped mass of the aircraft ($kgm$), $I_y$ is the moment of inertia about the pitching axis ($m^2 / kgm$), $\tau$ is the actuator time constant and $U_o$ the reference flight speed.

Sensor data is available at discrete time instants and the observation model $y(t_k) \in \mathbb{R}^1$ 

\begin{equation}
y(t_k) = q(t_k-\delta_{t_k}) + v(t_k)
\end{equation} \duvida{É melhor representar y como sendo de 3 dimensoes, considerando 0 para os outros estados?}

\noindent
is given by the pitch rate about the center of mass $q$ and $v(t_k) \sim \mathcal{N} (0,R_{t_k})$ is the observation noise, with zero mean and covariance $R_{t_k}$. When time-stamp is not available, the observation vector is approximated by $\tilde{y}_i \approx y(t_k)$, where $i$ is the index of the next time instant, multiple of $T$.

\subsection{Measurement Signal-to-Noise Ratio Variation}\label{sec:ruido-AC}

\subsection{Average Sampling Rate Variation}\label{sec:lambda-AC}

\subsection{Regular and Average Irregular Time Interval Variation}\label{sec:alpha-AC}

\subsection{Average Time Dela}\label{sec:dt-AC}



\subsubsection{System simulated with interpolated noise created at 0.1s (sigma = 1)}

\begin{figure}[h!]
	\centering
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_q_noise.eps}	
		%		\caption{}
		\label{fig:q_AC-1}
	\end{subfigure}
	
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_W_noise.eps}
		%		\caption{}
		\label{fig:W_AC-1}
	\end{subfigure}
	
	\caption[Entradas]{One realization of aircraft pitch rate at the center of mass and normal component of linear velocity}
	\label{fig:aircraft1}
	
\end{figure}


\clearpage

\subsubsection{System simulated with interpolated noise created at 0.1s (sigma = 10)}
\begin{figure}[h!]
	\centering
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_q_noise10x.eps}	
		%		\caption{}
		\label{fig:q_AC}
	\end{subfigure}
	
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_W_noise10x.eps}
		%		\caption{}
		\label{fig:W_AC}
	\end{subfigure}
	
	\caption[Entradas]{One realization of aircraft pitch rate at the center of mass and normal component of linear velocity}
	\label{fig:aircraft}
	
\end{figure}

\begin{figure}[h!]
	\centering
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_noise-realization1x.eps}	
		%		\caption{}
		\label{fig:noise1}
	\end{subfigure}
	
	\begin{subfigure}
		\centering
		\includegraphics[scale=0.75]{Imagens/AC_noise_realization10x.eps}
		%		\caption{}
		\label{fig:noise10}
	\end{subfigure}
	
	\caption[Entradas]{Noise realization with $\sigma=1$ and $\sigma=10$ and generated with a time-step of 0.1 s and interpolated for 1e-6 simulation}
	\label{fig:noise-realization}
	
\end{figure}

\clearpage


\clearpage
